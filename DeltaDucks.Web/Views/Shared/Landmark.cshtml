@using DeltaDucks.Data
@using Microsoft.AspNet.Identity
@model DeltaDucks.Web.ViewModels.LandmarkViewModel


<script src="../../Scripts/sweetalert.min.js"></script>
<script src="../../Scripts/js/enterCode.js"></script>
<link rel="stylesheet" type="text/css" href="../../Content/sweetalert.css">
<div class="panel panel-default">
    <div class="panel-heading">
        @Html.Label(Model.Name)
    </div>
    <div class="panel-body">
        <div class="media-body">

            <p>Номер: @Model.Number</p>
            @if (Model.Pictures.Count > 0)
            {
                <img src="@String.Format("data:image/png;base64,{0}", Convert.ToBase64String(Model.Pictures.ElementAt(0).ImageData))" style="width: 160px; height: 160px; background: #FFFFFF;
                                      margin: auto;
                                      padding: 6px;
                                      box-shadow: 0px 0px 20px #888;" />
            }  
            <p>@Model.Description</p>
            <p>Точки: @Model.Points</p>
            <p>Посещения: @Model.Visits</p>
        </div>
    </div>
    <a href="@Url.Action("Details","Landmark", new {number = Model.Number})" class="btn btn-default"
       style="margin: 15px">Още</a>
    @*TODO: Add pop-up for code *@


    @{
        if (User.Identity.IsAuthenticated)
        {
            var context = new DeltaDucksContext();
            using (context)
            {
                var userId = User.Identity.GetUserId();
                var user = context.Users.FirstOrDefault(u => u.Id == userId);

                if (user.VisitedLandmarks.Select(l => l.Number).ToList().Contains(Convert.ToByte(Model.Number)))
                {
                    <p class="btn btn-default"
                       style="margin: 15px; float: right; color: green">Посетено</p>
                }
                else
                {
                    <button onclick="enterCode(@Model.Number)" id="enterCodeBtn"
                            class="btn btn-default"
                            style="margin: 15px; float: right">
                        Въведи посещение
                    </button>
                }

            }
        }

    }
   
</div>


